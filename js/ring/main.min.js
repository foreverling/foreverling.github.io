function createRing(){var a=[{x1:centerX+r1,y1:centerY,x2:centerX+r2,y2:centerY}];$("#div1").animate({move:"auto"},{duration:1e3,easing:"swing",step:function(e,t){a=[{x1:400,x2:450,y1:250,y2:250}];for(var r=0;r<dataArr.length;r++){var n=r1*Math.cos(angle[r]*t.pos)+centerX,l=r2*Math.cos(angle[r]*t.pos)+centerX,o=r1*Math.sin(angle[r]*t.pos)+centerY,c=r2*Math.sin(angle[r]*t.pos)+centerY;a.push({x1:n,x2:l,y1:o,y2:c})}for(var r=0;r<a.length-1;r++){var d="M"+a[r].x1+" "+a[r].y1+"A"+r1+" "+r1+" 0 0 1 "+a[r+1].x1+" "+a[r+1].y1+"L"+a[r+1].x2+" "+a[r+1].y2+"A"+r2+" "+r2+" 0 0 0 "+a[r].x2+" "+a[r].y2+"Z",i=transAngle[r].x*t.pos,g=transAngle[r].y*t.pos;aPath[r].setAttribute("d",d),aG[r].setAttribute("transform","translate("+i+","+g+")")}}})}function desc(){for(var a=0;a<dataArr.length;a++){var e=createTag("g",{}),t=createTag("text",{x:centerX,y:centerY-5,"font-size":20,"text-anchor":"middle"}),r=createTag("text",{x:centerX,y:centerY+21,"font-size":20,"text-anchor":"middle"});t.innerHTML=dataArr[a].data+"%",r.innerHTML=dataArr[a].desc,e.appendChild(t),e.appendChild(r),oSvg.appendChild(e)}var n=createTag("text",{x:10,y:50,"font-size":20,"text-anchor":"right",stroke:"#61a0a8"});n.innerHTML="某站点用户访问来源",oSvg.appendChild(n)}function createTag(a,e){var t="http://www.w3.org/2000/svg",r=document.createElementNS(t,a);for(var n in e)r.setAttribute(n,e[n]);return r}var oDiv1=document.getElementById("div1"),centerX=300,centerY=250,r1=100,r2=150,angle=[],transAngle=[],transAngleFinal=null,angleFinal=null,dataArr=[{desc:"直接访问",data:13.08,color:"#39bcae"},{desc:"邮件营销",data:12.1,color:"#6f87ce"},{desc:"联盟广告",data:9.13,color:"#fa7953"},{desc:"视频广告",data:5.27,color:"#f6b51d"},{desc:"百度",data:40.91,color:"#78e6e6"},{desc:"谷歌",data:9.8,color:"#bda29a"},{desc:"其他",data:3.98,color:"#6e7074"},{desc:"必应",data:5.74,color:"#546570"}],oSvg=createTag("svg",{width:"100%",height:"100%"});oDiv1.appendChild(oSvg);for(var aPath=oSvg.getElementsByTagName("path"),aG=oSvg.getElementsByTagName("g"),i=0;i<dataArr.length;i++){angleFinal+=dataArr[i].data,i==dataArr.length-1&&(angleFinal=100),angle.push(angleFinal/100*2*Math.PI),transAngleFinal=0==i?angle[i]/2:angle[i-1]+dataArr[i].data/2/100*2*Math.PI,transAngle.push({x:200*Math.cos(transAngleFinal),y:200*Math.sin(transAngleFinal)});var oPoly=createTag("path",{fill:dataArr[i].color});oSvg.appendChild(oPoly)}desc(),createRing();