function detect(t){var e=t.clientX-can3.getBoundingClientRect().left,n=(t.clientY-can3.getBoundingClientRect().top,!1);ctx3.clearRect(0,0,canW,canH);for(var i=0;i<newMove.length-1;i++)e>newMove[i]&&e<=newMove[i+1]&&(n=!0,oDate.innerHTML=lineData.date[i],oCon1.innerHTML="最高气温："+lineData.highest[i],oCon2.innerHTML="最低气温："+lineData.lowest[i],oTip.style.left=can3.getBoundingClientRect().left+50+lineWidth*i+"px",oTip.style.top=t.clientY+"px",oTip.style.display="block",ctx3.beginPath(),ctx3.moveTo(lineWidth*i+50,50),ctx3.lineTo(lineWidth*i+50,canH-50),ctx3.stroke(),ctx3.beginPath(),ctx3.fillStyle="#f3f3f3",ctx3.strokeStyle="#c23531",ctx3.arc(50+lineWidth*i,vHeight-(lineData.highest[i]-minNum)/(maxNum-minNum)*vHeight+50,6,0,2*Math.PI),ctx3.fill(),ctx3.stroke(),ctx3.beginPath(),ctx3.fillStyle="#f3f3f3",ctx3.strokeStyle="#2f4554",ctx3.arc(50+lineWidth*i,vHeight-(lineData.lowest[i]-minNum)/(maxNum-minNum)*vHeight+50,6,0,2*Math.PI),ctx3.fill(),ctx3.stroke());n||(oTip.style.display="none")}function drawLine(){ctx1.clearRect(0,0,canW,canH),ctx2.clearRect(0,0,canW,canH),ctx3.clearRect(0,0,canW,canH),ctx1.fillStyle="#f3f3f3",ctx1.strokeStyle="#ccc",ctx1.fillRect(0,0,canW,canH),ctx1.strokeRect(0,0,canW,canH),drawTitle(),drawGrid(),animateLine()}function drawTitle(){ctx1.fillStyle="#333",ctx1.textAlign="left",ctx1.textBaseline="top",ctx1.font="bold 16px sans-serif",ctx1.fillText(lineData.title,10,10),ctx1.font="12px sans-serif",ctx1.fillText(lineData.legend[0],canW/2-60,10),ctx1.font="12px sans-serif",ctx1.fillText(lineData.legend[1],canW/2+25,10),ctx1.fillStyle="#aaa",ctx1.textAlign="left",ctx1.fillText(lineData.subTitle,10,30),ctx1.strokeStyle="#c23531",ctx1.beginPath(),ctx1.moveTo(canW/2-85,15),ctx1.lineTo(canW/2-80,15),ctx1.stroke(),ctx1.beginPath(),ctx1.arc(canW/2-75,15,5,0,2*Math.PI),ctx1.stroke(),ctx1.beginPath(),ctx1.moveTo(canW/2-70,15),ctx1.lineTo(canW/2-65,15),ctx1.stroke(),ctx1.strokeStyle="#333",ctx1.beginPath(),ctx1.moveTo(canW/2,15),ctx1.lineTo(canW/2+5,15),ctx1.stroke(),ctx1.beginPath(),ctx1.arc(canW/2+10,15,5,0,2*Math.PI),ctx1.stroke(),ctx1.beginPath(),ctx1.moveTo(canW/2+15,15),ctx1.lineTo(canW/2+20,15),ctx1.stroke()}function drawGrid(){getGreat(),ctx1.fillStyle="#333",ctx1.textAlign="right",ctx1.textBaseline="middle";for(var t=0;t<=vNum;t++)ctx1.beginPath(),ctx1.strokeStyle="#333",ctx1.moveTo(50,canH-50-t*vHeight/vNum),ctx1.lineTo(45,canH-50-t*vHeight/vNum),ctx1.stroke(),ctx1.beginPath(),ctx1.strokeStyle="#ccc",ctx1.moveTo(50,canH-50-t*vHeight/vNum),ctx1.lineTo(canW-50,canH-50-t*vHeight/vNum),ctx1.stroke(),ctx1.fillText(minNum+perVertical*t+" ℃",40,canH-50-t*vHeight/vNum);ctx1.strokeStyle="#333",ctx1.beginPath(),ctx1.moveTo(50,canH-50),ctx1.lineTo(50,50),ctx1.stroke();var e=Math.abs(minNum)/perVertical,n=canH-50-vHeight/vNum*e;ctx1.beginPath(),ctx1.moveTo(50,n),ctx1.lineTo(canW-50,n),ctx1.stroke(),ctx1.strokeStyle="#333",ctx1.fillStyle="#333",ctx1.textAlign="center",ctx1.textBaseline="middle";for(var t=0;t<arrLen;t++)ctx1.beginPath(),ctx1.moveTo(50+lineWidth*t,n),ctx1.lineTo(50+lineWidth*t,n+5),ctx1.stroke(),ctx1.fillText(lineData.date[t],50+lineWidth*t,canH-50+16)}function getGreat(){highArr=[],lowArr=[];for(var t=0;t<lineData.highest.length;t++)highArr.push(lineData.highest[t]),lowArr.push(lineData.lowest[t]);maxNum=highArr.sort(function(t,e){return e-t})[0],minNum=lowArr.sort(function(t,e){return t-e})[0],maxNum=Math.ceil(maxNum),minNum=Math.floor(minNum);var e=maxNum-minNum;e%vNum&&(e=(Math.floor(e/vNum)+1)*vNum),perVertical=e/vNum;var n=0;minNum<=0&&(n=Math.abs(Math.floor(minNum/perVertical))),minNum<=0?(minNum=-perVertical*n,maxNum=minNum+e):(minNum=0,maxNum=Math.ceil(maxNum/vNum)*vNum);for(var i=0,l=0,t=0;t<highArr.length;t++)i+=highArr[t],l+=lowArr[t];highAve=(i/highArr.length).toFixed(2),lowAve=(l/highArr.length).toFixed(2)}function animateLine(){var t=!1;inAll=0,timer=setInterval(function(){if(inAll>5)clearInterval(timer);else{5==inAll&&(t=!0),ctx2.beginPath(),ctx2.strokeStyle="#c23531",ctx2.moveTo(50+lineWidth*inAll,vHeight-(lineData.highest[inAll]-minNum)/(maxNum-minNum)*vHeight+50),ctx2.lineTo(50+lineWidth*(inAll+1),vHeight-(lineData.highest[inAll+1]-minNum)/(maxNum-minNum)*vHeight+50),ctx2.stroke(),ctx2.beginPath(),ctx2.fillStyle="#f3f3f3",ctx2.arc(50+lineWidth*inAll,vHeight-(lineData.highest[inAll]-minNum)/(maxNum-minNum)*vHeight+50,3,0,2*Math.PI),ctx2.fill(),ctx2.stroke(),ctx2.beginPath(),ctx2.strokeStyle="#2f4554",ctx2.moveTo(50+lineWidth*inAll,vHeight-(lineData.lowest[inAll]-minNum)/(maxNum-minNum)*vHeight+50),ctx2.lineTo(50+lineWidth*(inAll+1),vHeight-(lineData.lowest[inAll+1]-minNum)/(maxNum-minNum)*vHeight+50),ctx2.stroke(),ctx2.beginPath(),ctx2.fillStyle="#f3f3f3",ctx2.arc(50+lineWidth*inAll,vHeight-(lineData.lowest[inAll]-minNum)/(maxNum-minNum)*vHeight+50,3,0,2*Math.PI),ctx2.fill(),ctx2.stroke();var e=vHeight-(highAve-minNum)/(maxNum-minNum)*vHeight+50,n=vHeight-(lowAve-minNum)/(maxNum-minNum)*vHeight+50;dashLine(lineWidth*inAll+50,e,lineWidth*(inAll+1)+50,e,5,1,"#c23531",highAve,t),dashLine(lineWidth*inAll+50,n,lineWidth*(inAll+1)+50,n,5,1,"#2f4554",lowAve,t),inAll++}},200)}function dashLine(t,e,n,i,l,c,a,o,x){l=void 0===l?5:l;var m=getBeveling(n-t,i-e),h=Math.floor(m/l);ctx2.strokeStyle=a,ctx2.lineWidth=c,ctx2.beginPath();for(var r=0;r<h;r++)ctx2[r%2==0?"moveTo":"lineTo"](t+(n-t)/h*r,e+(i-e)/h*r);ctx2.stroke(),ctx2.closePath(),x&&(ctx2.fillStyle=a,ctx2.beginPath(),ctx2.moveTo(n,i),ctx2.lineTo(n-20,i-5),ctx2.lineTo(n-15,i),ctx2.lineTo(n-20,i+5),ctx2.closePath(),ctx2.fill(),ctx2.fillText(o,n+12,i+5))}function getBeveling(t,e){return Math.sqrt(Math.pow(t,2)+Math.pow(e,2))}var oDiv1=document.getElementById("div1"),can1=document.getElementById("can1"),can2=document.getElementById("can2"),can3=document.getElementById("can3"),ctx1=can1.getContext("2d"),ctx2=can2.getContext("2d"),ctx3=can3.getContext("2d"),oInput1=document.getElementById("input1"),oInput2=document.getElementById("input2"),oBtn=document.getElementById("btn"),oTip=document.getElementById("tip"),oCon1=document.getElementById("content1"),oCon2=document.getElementById("content2"),oDate=document.getElementById("date"),canW=600,canH=400,maxNum=0,minNum=0,highAve=0,lowAve=0,highArr=[],lowArr=[],newMove=[50],vNum=6;perVertical=0,vHeight=canH-100,hWidth=canW-100,lineWidth=hWidth/vNum,arrLen=7,inAll=0,timer=null,lineData={title:"未来一周气温变化",subTitle:"纯属虚构",legend:["最高气温","最低气温"],highest:[11,11,15,13,12,13,10],lowest:[1,-2,2,5,3,2,0],date:["周一","周二","周三","周四","周五","周六","周日"]};for(var i=0;i<arrLen;i++)0==i?newMove.push(lineWidth/2+50):i==arrLen-2?newMove.push(5.5*lineWidth+50):i==arrLen-1?newMove.push(550):newMove.push(lineWidth*(i+.5)+50);oBtn.onclick=function(){var t=oInput1.value.split(","),e=oInput2.value.split(",");if(oTip.style.display="none",7!=t.length&&7!=e.length)alert("注意每组七个数！");else{for(var n=0;n<7;n++)t[n]=Number(t[n]),e[n]=Number(e[n]);lineData.highest=t,lineData.lowest=e,drawLine()}},can1.width=canW,can1.height=canH,can2.width=canW,can2.height=canH,can3.width=canW,can3.height=canH,oInput1.value=lineData.highest,oInput2.value=lineData.lowest,drawLine(),can3.addEventListener("mousemove",detect);