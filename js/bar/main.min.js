function detect(t){for(var e=t.clientX-can.getBoundingClientRect().left,a=t.clientY-can.getBoundingClientRect().top,n=!1,i=0;i<arrLen;i++)ctx.beginPath(),ctx.rect((20+barWidth)*i+10+50,canHeight-50-newHeight[i],barWidth,newHeight[i]),ctx.isPointInPath(e,a)?(ctx.fillStyle="#e97572",n=!0,oCont.innerHTML=barData.chartData[i].name+":"+barData.chartData[i].sale,oTip.style.left=t.clientX+20+"px",oTip.style.top=t.clientY+"px",oTip.style.display="block",ctx.fill()):(ctx.fillStyle="#c23531",ctx.fill()),ctx.closePath();n?can.style.cursor="pointer":(oTip.style.display="none",can.style.cursor="auto")}function drawBar(){drawTitle(),drawGrid(),setTimeout(function(){animateBar()},500)}function drawTitle(){ctx.fillStyle="#333",ctx.textAlign="left",ctx.textBaseline="top",ctx.font="bold 18px sans-serif",ctx.fillText(barData.title,10,10),ctx.font="14px sans-serif",ctx.fillText(barData.legend,canWidth/2,10),ctx.fillStyle="#c23531",ctx.fillRect(canWidth/2-35,10,25,15)}function drawGrid(){ctx.strokeStyle="#333",ctx.beginPath(),ctx.moveTo(50,canHeight-50),ctx.lineTo(50,50),ctx.stroke(),ctx.beginPath(),ctx.moveTo(50,canHeight-50),ctx.lineTo(canWidth-50,canHeight-50),ctx.stroke(),perVertical=getMaxNum()/5,arrLen=numberArr.length,barWidth=(hWidth-20*arrLen)/arrLen,ctx.fillStyle="#333",ctx.textAlign="right",ctx.textBaseline="middle";for(var t=0;t<=5;t++)ctx.beginPath(),ctx.strokeStyle="#333",ctx.moveTo(50,canHeight-50-t*vHeight/5),ctx.lineTo(45,canHeight-50-t*vHeight/5),ctx.stroke(),ctx.beginPath(),ctx.strokeStyle="#ccc",ctx.moveTo(50,canHeight-50-t*vHeight/5),ctx.lineTo(canWidth-50,canHeight-50-t*vHeight/5),ctx.stroke(),ctx.fillText(perVertical*t,40,canHeight-50-t*vHeight/5);ctx.strokeStyle="#333",ctx.fillStyle="#333",ctx.textAlign="center",ctx.textBaseline="middle";for(var t=0;t<arrLen+1;t++)ctx.beginPath(),ctx.moveTo(50+(20+barWidth)*t,canHeight-50),ctx.lineTo(50+(20+barWidth)*t,canHeight-45),ctx.stroke(),t!=arrLen&&ctx.fillText(barData.chartData[t].name,50+(barWidth+20)*(t+.5),canHeight-30)}function animateBar(){for(var t=0;t<arrLen;t++)newHeight.push(barData.chartData[t].sale/maxNumber*vHeight);gainHeight(),myReq=requestAnimationFrame(gainHeight),cancelAnimationFrame(myReq)}function gainHeight(){percentNum+=.05,ctx.save(),ctx.fillStyle="#c23531";for(var t=0;t<arrLen;t++)ctx.fillRect((20+barWidth)*t+10+50,canHeight-50-newHeight[t]*percentNum,barWidth,newHeight[t]*percentNum);ctx.restore(),percentNum<=1&&(myReq=requestAnimationFrame(gainHeight))}function getMaxNum(){for(var t=0;t<barData.chartData.length;t++)numberArr.push(barData.chartData[t].sale);return numberArr.sort(function(t,e){return e-t}),maxNumber=numberArr[0],maxNumber%10&&(maxNumber=10*Math.ceil(maxNumber/10)),maxNumber}var can=document.getElementById("canvas"),ctx=can.getContext("2d"),oTip=document.getElementById("tip"),oCont=document.getElementById("content"),canWidth=600,canHeight=400,numberArr=[],newHeight=[],maxNumber=0,perVertical=0,percentNum=0,arrLen=0,vHeight=canHeight-100,hWidth=canWidth-100,barWidth=0,myReq,barData={title:"某服装店日销量",legend:"销量",chartData:[{name:"衬衫",sale:5},{name:"羊毛衫",sale:20},{name:"雪纺衫",sale:36},{name:"裤子",sale:10},{name:"高跟鞋",sale:10},{name:"袜子",sale:160}]};ctx.fillStyle="#f3f3f3",ctx.strokeStyle="#ccc",ctx.fillRect(0,0,can.width,can.height),ctx.strokeRect(0,0,can.width,can.height);var requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,cancelAnimationFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame;drawBar(),can.addEventListener("mousemove",detect);